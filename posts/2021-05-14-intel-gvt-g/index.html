<!doctype html><html lang=en-us prefix="og: https://ogp.me/ns#"><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=content-security-policy content="form-action 'none'; upgrade-insecure-requests; block-all-mixed-content; base-uri 'none'"><meta property="og:title" content="Intel GVT-g - 忘れないように... 2"><title>Intel GVT-g - 忘れないように... 2</title><meta property="og:description" content><meta name=description content><meta property="og:author" content="soracat"><meta property="og:url" content="https://soracqt.github.io/posts/2021-05-14-intel-gvt-g/"><link rel=stylesheet href="/scss/main.min.e31351cf7100a4f64271b6d799eaf8b968d1e6f2c5191d585f16371906f32e72.css"><link rel=icon href=../../favicon/favicon.ico><link rel=apple-touch-icon sizes=180x180 href=../../favicon/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon/favicon-16x16.png><meta property="og:image" content="/favicon/og-image.png"></head><body><div class=header-nav><header><a href=../../><img src alt=icon width=50 height=50><h1>忘れないように... 2</h1></a></header><nav><a href=../../posts/ title>Posts</a>
<a href=../../tags/ title>Tags</a></nav></div><div class=article-labels><div class=tags><p><a href=../../tags>Tags:</a> <a href=../../tags/intel>[intel]</a> <a href=../../tags/linux>[linux]</a> <a href=../../tags/qemu>[qemu]</a> <a href=../../tags/pci-passthrough>[pci-passthrough]</a></p></div></div><main><article><div class=article-header><h1>Intel GVT-g</h1><span class=author-date><p>By <a href=https://github.com/soracqt>soracat</a> · Made at: 2021/05/14</p></span></div><div class=article-content><h2 id=前提条件>前提条件
<a class=anchor href=#%e5%89%8d%e6%8f%90%e6%9d%a1%e4%bb%b6>🔗</a></h2><p>linux >= 4.16</p><p>qemu >= 2.12</p><h2 id=設定>設定
<a class=anchor href=#%e8%a8%ad%e5%ae%9a>🔗</a></h2><p><code>/etc/modprobe.d/i915.conf</code></p><div class=highlight><pre tabindex=0 style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>options i915 ... enable_gvt<span style=color:#81a1c1>=</span><span style=color:#b48ead>1</span> enable_guc<span style=color:#81a1c1>=</span><span style=color:#b48ead>0</span> ...
</span></span></code></pre></div><p><code>/etc/modules-load.d/intel_gvt-g.conf</code></p><div class=highlight><pre tabindex=0 style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kvmgt
</span></span><span style=display:flex><span>vfio-iommu-type1
</span></span><span style=display:flex><span>vfio-mdev
</span></span></code></pre></div><p><code>/etc/default/grub</code></p><div class=highlight><pre tabindex=0 style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>GRUB_CMDLINE_LINUX<span style=color:#81a1c1>=</span><span style=color:#a3be8c>&#34;... intel_iommu=on ...&#34;</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo grub-mkconfig -o /boot/grub/grub.cfg
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo reboot
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>lspci -Dnn<span style=color:#eceff4>|</span>grep VGA
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>GVT_PCI<span style=color:#81a1c1>=</span>0000<span style=color:#ebcb8b>\:</span>00<span style=color:#ebcb8b>\:</span>02.0
</span></span><span style=display:flex><span>ls /sys/bus/pci/devices/$GVT_PCI/mdev_supported_types/
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>GVT_GUID<span style=color:#81a1c1>=</span><span style=color:#81a1c1;font-weight:700>$(</span>uuidgen<span style=color:#81a1c1;font-weight:700>)</span>
</span></span><span style=display:flex><span>GVT_PCI<span style=color:#81a1c1>=</span>0000<span style=color:#ebcb8b>\:</span>00<span style=color:#ebcb8b>\:</span>02.0
</span></span><span style=display:flex><span>GVT_TYPE<span style=color:#81a1c1>=</span>i915-GVTg_V5_4
</span></span><span style=display:flex><span><span style=color:#81a1c1>echo</span> <span style=color:#a3be8c>&#34;</span>$GVT_GUID<span style=color:#a3be8c>&#34;</span><span style=color:#eceff4>|</span>sudo tee <span style=color:#a3be8c>&#34;/sys/bus/pci/devices/</span>$GVT_PCI<span style=color:#a3be8c>/mdev_supported_types/</span>$GVT_TYPE<span style=color:#a3be8c>/create&#34;</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>qemu-system-x86_64 <span style=color:#ebcb8b>\
</span></span></span><span style=display:flex><span><span style=color:#ebcb8b></span>  -device vfio-pci,sysfsdev<span style=color:#81a1c1>=</span>/sys/bus/mdev/devices/$GVT_GUID
</span></span></code></pre></div><h1 id=参考>参考
<a class=anchor href=#%e5%8f%82%e8%80%83>🔗</a></h1><p><a href=https://kagasu.hatenablog.com/entry/2021/01/05/201126>https://kagasu.hatenablog.com/entry/2021/01/05/201126</a></p><p><a href=https://wiki.archlinux.org/title/Intel_GVT-g>https://wiki.archlinux.org/title/Intel_GVT-g</a></p></div></article></main><div class=article-related><p>Previous: <a href=https://soracqt.github.io/posts/2021-04-22-migrate-archrepo-to-manjaro/>archlinuxのリポジトリををmanjaroのリポジトリに切り替える</a></p><p>Next: <a href=https://soracqt.github.io/posts/2021-05-20-sway/>swayについて</a></p></div><div class=article-license></div><footer><p>© 2022 - soracat</footer></body></html>