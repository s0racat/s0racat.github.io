<!doctype html><html lang=en-us prefix="og: https://ogp.me/ns#"><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=content-security-policy content="form-action 'none'; upgrade-insecure-requests; block-all-mixed-content; base-uri 'none'"><meta property="og:title" content="sway Tips & トラブルシューティング - 忘れないように... 2"><title>sway Tips & トラブルシューティング - 忘れないように... 2</title><meta property="og:description" content><meta name=description content><meta property="og:author" content="soracat"><meta property="og:url" content="https://soracqt.github.io/posts/2021-05-20-sway/"><link rel=stylesheet href=../../scss/main.css><link rel=icon href=../../favicon/favicon.ico><link rel=apple-touch-icon sizes=180x180 href=../../favicon/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../favicon/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../favicon/favicon-16x16.png><meta property="og:image" content="/favicon/og-image.png"></head><body><div class=header-nav><header><a href=../../><img src=../../img/icon.jpg alt="icon by Neko" width=50 height=50><h1>忘れないように... 2</h1></a></header><nav><a href=../../posts/ title>Posts</a>
<a href=../../tags/ title>Tags</a></nav></div><div class=article-labels><div class=tags><p><a href=../../tags>Tags:</a> <a href=../../tags/swaywm>[swaywm]</a> <a href=../../tags/wayland>[wayland]</a> <a href=../../tags/linux>[linux]</a> <a href=../../tags/xorg>[xorg]</a> <a href=../../tags/tiling-window-manager>[tiling-window-manager]</a></p></div></div><main><article><div class=article-header><h1>sway Tips & トラブルシューティング</h1><span class=author-date><p>By <a href=https://github.com/soracqt>soracat</a> · Made at: 2021/05/20</p></span></div><div class=article-content><p>誰かがswayの記事を書いてくれているのでトラブルシューティングを中心に書きます。</p><p>フルアーカイブは <a href=https://soracqt.github.io/oldblog/post/2021-05-20/>https://soracqt.github.io/oldblog/post/2021-05-20/</a> にもあります</p><h1 id=情報の探し方>情報の探し方
<a class=anchor href=#%e6%83%85%e5%a0%b1%e3%81%ae%e6%8e%a2%e3%81%97%e6%96%b9>🔗</a></h1><p>検索する場合、<a href="https://duckduckgo.com/?q=swaywm+site%3Aqiita.com">swaywm site:qiita.com(DuckDuckGo)</a> か <a href="https://duckduckgo.com/?q=swaywm+site%3Azenn.dev">swaywm site:zenn.dev(DuckDuckGo)</a>で出ます</p><p><a href=https://github.com/swaywm/sway/wiki>swaywm/sway(Github Wiki)</a></p><p><a href=https://github.com/emersion/xdg-desktop-portal-wlr/wiki>emersion/xdg-desktop-portal-wlr(Github Wiki)</a></p><p>他にもarchwikiで検索、gentoo wikiで検索すると情報が出てきます</p><h1 id=tips>Tips
<a class=anchor href=#tips>🔗</a></h1><h2 id=サスペンドした際にロック>サスペンドした際にロック
<a class=anchor href=#%e3%82%b5%e3%82%b9%e3%83%9a%e3%83%b3%e3%83%89%e3%81%97%e3%81%9f%e9%9a%9b%e3%81%ab%e3%83%ad%e3%83%83%e3%82%af>🔗</a></h2><p><code>sway/config</code></p><div class=highlight><pre tabindex=0 style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#81a1c1>exec</span> swayidle before-sleep <span style=color:#a3be8c>&#39;swaylock -f -c 000000; swaymsg &#34;output * dpms off&#34;&#39;</span> after-resume <span style=color:#a3be8c>&#39;swaymsg &#34;output * dpms on&#34;&#39;</span>
</span></span></code></pre></div><p>この例はswaylockを使ってますがお好みのスクリーンセーバーを使ってください</p><p>モニターの電源(dpms)も切ってくれます</p><h2 id=マシンに触らなかった場合自動でロック>マシンに触らなかった場合自動でロック
<a class=anchor href=#%e3%83%9e%e3%82%b7%e3%83%b3%e3%81%ab%e8%a7%a6%e3%82%89%e3%81%aa%e3%81%8b%e3%81%a3%e3%81%9f%e5%a0%b4%e5%90%88%e8%87%aa%e5%8b%95%e3%81%a7%e3%83%ad%e3%83%83%e3%82%af>🔗</a></h2><p><code>sway/config</code></p><div class=highlight><pre tabindex=0 style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#81a1c1>exec</span> swayidle -w <span style=color:#ebcb8b>\
</span></span></span><span style=display:flex><span><span style=color:#ebcb8b></span>          timeout <span style=color:#b48ead>300</span> <span style=color:#a3be8c>&#39;swaylock -f -c 000000&#39;</span> <span style=color:#ebcb8b>\
</span></span></span><span style=display:flex><span><span style=color:#ebcb8b></span>          timeout <span style=color:#b48ead>600</span> <span style=color:#a3be8c>&#39;swaymsg &#34;output * dpms off&#34;&#39;</span> resume <span style=color:#a3be8c>&#39;swaymsg &#34;output * dpms on&#34;&#39;</span> 
</span></span></code></pre></div><p>この場合5分でロックされ、その後10分後dpmsがオフになります</p><h2 id=firefoxを動かす>firefoxを動かす
<a class=anchor href=#firefox%e3%82%92%e5%8b%95%e3%81%8b%e3%81%99>🔗</a></h2><div class=highlight><pre tabindex=0 style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>MOZ_ENABLE_WAYLAND<span style=color:#81a1c1>=</span><span style=color:#b48ead>1</span> firefox
</span></span></code></pre></div><p>で起動しますが</p><p><code>~/.pam_environment</code>に書いて永続化します</p><div class=highlight><pre tabindex=0 style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#81a1c1>echo</span> MOZ_ENABLE_WAYLAND<span style=color:#81a1c1>=</span><span style=color:#b48ead>1</span> &gt;&gt; ~/.pam_environment
</span></span></code></pre></div><h1 id=トラブルシューティング>トラブルシューティング
<a class=anchor href=#%e3%83%88%e3%83%a9%e3%83%96%e3%83%ab%e3%82%b7%e3%83%a5%e3%83%bc%e3%83%86%e3%82%a3%e3%83%b3%e3%82%b0>🔗</a></h1><h2 id=xdg-desktop-portal-gtkの起動が失敗する>xdg-desktop-portal-gtkの起動が失敗する
<a class=anchor href=#xdg-desktop-portal-gtk%e3%81%ae%e8%b5%b7%e5%8b%95%e3%81%8c%e5%a4%b1%e6%95%97%e3%81%99%e3%82%8b>🔗</a></h2><p><a href=https://github.com/swaywm/sway/wiki#gtk-applications-take-20-seconds-to-start>https://github.com/swaywm/sway/wiki#gtk-applications-take-20-seconds-to-start</a></p><p><code>sway/config</code></p><div class=highlight><pre tabindex=0 style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>include /etc/sway/config.d/*
</span></span></code></pre></div><h2 id=gtkテーマが適用されない>gtkテーマが適用されない
<a class=anchor href=#gtk%e3%83%86%e3%83%bc%e3%83%9e%e3%81%8c%e9%81%a9%e7%94%a8%e3%81%95%e3%82%8c%e3%81%aa%e3%81%84>🔗</a></h2><p><a href=https://github.com/swaywm/sway/wiki/GTK-3-settings-on-Wayland>https://github.com/swaywm/sway/wiki/GTK-3-settings-on-Wayland</a></p><div class=highlight><pre tabindex=0 style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#5e81ac;font-style:italic>#!/bin/sh
</span></span></span><span style=display:flex><span><span style=color:#5e81ac;font-style:italic></span>
</span></span><span style=display:flex><span><span style=color:#616e87;font-style:italic># usage: import-gsettings</span>
</span></span><span style=display:flex><span>config<span style=color:#81a1c1>=</span><span style=color:#a3be8c>&#34;</span><span style=color:#a3be8c>${</span>XDG_CONFIG_HOME<span style=color:#81a1c1;font-weight:700>:-</span>$HOME<span style=color:#eceff4>/.config</span><span style=color:#a3be8c>}</span><span style=color:#a3be8c>/gtk-3.0/settings.ini&#34;</span>
</span></span><span style=display:flex><span><span style=color:#81a1c1;font-weight:700>if</span> <span style=color:#81a1c1>[</span> ! -f <span style=color:#a3be8c>&#34;</span>$config<span style=color:#a3be8c>&#34;</span> <span style=color:#81a1c1>]</span><span style=color:#eceff4>;</span> <span style=color:#81a1c1;font-weight:700>then</span> <span style=color:#81a1c1>exit</span> 1<span style=color:#eceff4>;</span> <span style=color:#81a1c1;font-weight:700>fi</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>gnome_schema<span style=color:#81a1c1>=</span><span style=color:#a3be8c>&#34;org.gnome.desktop.interface&#34;</span>
</span></span><span style=display:flex><span>gtk_theme<span style=color:#81a1c1>=</span><span style=color:#a3be8c>&#34;</span><span style=color:#81a1c1;font-weight:700>$(</span>grep <span style=color:#a3be8c>&#39;gtk-theme-name&#39;</span> <span style=color:#a3be8c>&#34;</span>$config<span style=color:#a3be8c>&#34;</span> <span style=color:#eceff4>|</span> cut -d<span style=color:#a3be8c>&#39;=&#39;</span> -f2<span style=color:#81a1c1;font-weight:700>)</span><span style=color:#a3be8c>&#34;</span>
</span></span><span style=display:flex><span>icon_theme<span style=color:#81a1c1>=</span><span style=color:#a3be8c>&#34;</span><span style=color:#81a1c1;font-weight:700>$(</span>grep <span style=color:#a3be8c>&#39;gtk-icon-theme-name&#39;</span> <span style=color:#a3be8c>&#34;</span>$config<span style=color:#a3be8c>&#34;</span> <span style=color:#eceff4>|</span> cut -d<span style=color:#a3be8c>&#39;=&#39;</span> -f2<span style=color:#81a1c1;font-weight:700>)</span><span style=color:#a3be8c>&#34;</span>
</span></span><span style=display:flex><span>cursor_theme<span style=color:#81a1c1>=</span><span style=color:#a3be8c>&#34;</span><span style=color:#81a1c1;font-weight:700>$(</span>grep <span style=color:#a3be8c>&#39;gtk-cursor-theme-name&#39;</span> <span style=color:#a3be8c>&#34;</span>$config<span style=color:#a3be8c>&#34;</span> <span style=color:#eceff4>|</span> cut -d<span style=color:#a3be8c>&#39;=&#39;</span> -f2<span style=color:#81a1c1;font-weight:700>)</span><span style=color:#a3be8c>&#34;</span>
</span></span><span style=display:flex><span>font_name<span style=color:#81a1c1>=</span><span style=color:#a3be8c>&#34;</span><span style=color:#81a1c1;font-weight:700>$(</span>grep <span style=color:#a3be8c>&#39;gtk-font-name&#39;</span> <span style=color:#a3be8c>&#34;</span>$config<span style=color:#a3be8c>&#34;</span> <span style=color:#eceff4>|</span> cut -d<span style=color:#a3be8c>&#39;=&#39;</span> -f2<span style=color:#81a1c1;font-weight:700>)</span><span style=color:#a3be8c>&#34;</span>
</span></span><span style=display:flex><span>cursor_size<span style=color:#81a1c1>=</span><span style=color:#a3be8c>&#34;</span><span style=color:#81a1c1;font-weight:700>$(</span>grep <span style=color:#a3be8c>&#39;gtk-cursor-theme-size&#39;</span> <span style=color:#a3be8c>&#34;</span>$config<span style=color:#a3be8c>&#34;</span> <span style=color:#eceff4>|</span> cut -d<span style=color:#a3be8c>&#39;=&#39;</span> -f2<span style=color:#81a1c1;font-weight:700>)</span><span style=color:#a3be8c>&#34;</span>
</span></span><span style=display:flex><span>gsettings <span style=color:#81a1c1>set</span> <span style=color:#a3be8c>&#34;</span>$gnome_schema<span style=color:#a3be8c>&#34;</span> gtk-theme <span style=color:#a3be8c>&#34;</span>$gtk_theme<span style=color:#a3be8c>&#34;</span>
</span></span><span style=display:flex><span>gsettings <span style=color:#81a1c1>set</span> <span style=color:#a3be8c>&#34;</span>$gnome_schema<span style=color:#a3be8c>&#34;</span> icon-theme <span style=color:#a3be8c>&#34;</span>$icon_theme<span style=color:#a3be8c>&#34;</span>
</span></span><span style=display:flex><span>gsettings <span style=color:#81a1c1>set</span> <span style=color:#a3be8c>&#34;</span>$gnome_schema<span style=color:#a3be8c>&#34;</span> cursor-theme <span style=color:#a3be8c>&#34;</span>$cursor_theme<span style=color:#a3be8c>&#34;</span>
</span></span><span style=display:flex><span>gsettings <span style=color:#81a1c1>set</span> <span style=color:#a3be8c>&#34;</span>$gnome_schema<span style=color:#a3be8c>&#34;</span> font-name <span style=color:#a3be8c>&#34;</span>$font_name<span style=color:#a3be8c>&#34;</span>
</span></span><span style=display:flex><span>gsettings <span style=color:#81a1c1>set</span> <span style=color:#a3be8c>&#34;</span>$gnome_schema<span style=color:#a3be8c>&#34;</span> cursor-size <span style=color:#a3be8c>&#34;</span>$cursor_size<span style=color:#a3be8c>&#34;</span>
</span></span></code></pre></div><p>Lxappearanceなどでカーソルサイズを設定していた場合、それも設定されるようにちょっと変更を加えてます</p><p>実行権限が必要です</p><p><code>sway/config</code></p><div class=highlight><pre tabindex=0 style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>exec_always /path/to/import-gsettings
</span></span></code></pre></div><h2 id=floating-windowが機能しない>floating windowが機能しない
<a class=anchor href=#floating-window%e3%81%8c%e6%a9%9f%e8%83%bd%e3%81%97%e3%81%aa%e3%81%84>🔗</a></h2><p>i3wmからswayになってWM_CLASSではなくapp_idを使うようになったようです</p><p>例です</p><p><code>sway/config</code></p><div class=highlight><pre tabindex=0 style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>for_window <span style=color:#81a1c1>[</span>app_id<span style=color:#81a1c1>=</span><span style=color:#a3be8c>&#34;gpartedbin&#34;</span><span style=color:#81a1c1>]</span> floating <span style=color:#81a1c1>enable</span>
</span></span></code></pre></div><p><code>swaymsg -t get_tree | grep "app_id"</code> で起動しているwindowのapp_idが取得できます</p><p>swaymsg使うとxwaylandで起動してるソフトがnullになるんですが</p><p><code>xprop | grep WM_CLASS</code> で取得して</p><p><code>sway/config</code></p><div class=highlight><pre tabindex=0 style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>for_window <span style=color:#81a1c1>[</span>class<span style=color:#81a1c1>=</span><span style=color:#a3be8c>&#34;Lxappearance&#34;</span><span style=color:#81a1c1>]</span> floating <span style=color:#81a1c1>enable</span>
</span></span></code></pre></div><p>でできました</p><h2 id=gpartedが動かない>gpartedが動かない
<a class=anchor href=#gparted%e3%81%8c%e5%8b%95%e3%81%8b%e3%81%aa%e3%81%84>🔗</a></h2><p>polkitの権限要求が何故かxwaylandで動かないようです</p><p>xhostをインストールして再起動すると動きます</p><p>archlinuxではパッケージ名は<code>xorg-xhost</code>です</p><div class=highlight><pre tabindex=0 style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo -E gparted
</span></span></code></pre></div><p>でも動きます</p><h2 id=flameshot>flameshot
<a class=anchor href=#flameshot>🔗</a></h2><pre tabindex=0><code>export XDG_CURRENT_DESKTOP=sway
</code></pre><h2 id=non-systemdな環境でflameshotを動かす>non systemdな環境でflameshotを動かす
<a class=anchor href=#non-systemd%e3%81%aa%e7%92%b0%e5%a2%83%e3%81%a7flameshot%e3%82%92%e5%8b%95%e3%81%8b%e3%81%99>🔗</a></h2><div class=highlight><pre tabindex=0 style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#81a1c1>export</span> XDG_CURRENT_DESKTOP<span style=color:#81a1c1>=</span>sway
</span></span></code></pre></div><p><code>sway/config</code></p><div class=highlight><pre tabindex=0 style=color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#81a1c1>exec</span> --no-startup-id dbus-update-activation-environment DISPLAY I3SOCK SWAYSOCK WAYLAND_DISPLAY XDG_CURRENT_DESKTOP<span style=color:#81a1c1>=</span>sway
</span></span></code></pre></div><p><a href="https://github.com/emersion/xdg-desktop-portal-wlr/wiki/%22It-doesn't-work%22-Troubleshooting-Checklist#non-systemd-distributions=">https://github.com/emersion/xdg-desktop-portal-wlr/wiki/%22It-doesn't-work%22-Troubleshooting-Checklist#non-systemd-distributions=</a></p><h1 id=さいごに>さいごに
<a class=anchor href=#%e3%81%95%e3%81%84%e3%81%94%e3%81%ab>🔗</a></h1><p>僕のdotfilesリポジトリです</p><p><a href=https://github.com/soracqt/config-artix/>https://github.com/soracqt/config-artix/</a></p></div></article></main><div class=article-related><p>Previous: <a href=https://soracqt.github.io/posts/2021-05-14-intel-gvt-g/>Intel GVT-g</a></p><p>Next: <a href=https://soracqt.github.io/posts/2021-05-26-i3wm/>i3wmについて</a></p></div><div class=article-license></div><footer><p>© 2022 - soracat</footer></body></html>